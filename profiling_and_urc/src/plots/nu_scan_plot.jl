using LinearAlgebra, LsqFit, Printf, DelimitedFiles, Plots, SpecialFunctions, LaTeXStrings

nu_range = 62:0.01:63

peqs = zeros(length(nu_range))
peqs_noise = zeros(length(nu_range))
peqs_jim = zeros(length(nu_range))
peqs_jim_nu = zeros(length(nu_range))
peqs_desmond = zeros(length(nu_range))

orbits = 2000
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

for (i, n) in enumerate(nu_range)

    filename = @sprintf "nu_scan_base/polarizations_0.0005_2000_4096_%.2f_ISF.txt" n

    step_polarizations = readdlm(filename, Float64)
    step_polarizations = vec(step_polarizations)

    model1(t, param) = param[1] * exp.(param[2] * t)
    param1 = [1, -0.001]
    lsq_fit = curve_fit(model1, t, step_polarizations, param1)

    cof = pi / (619 * 2)
    τ_dep_inv(ζ; cof=1) = cof * ((ζ^2 - 1) * -expintx(ζ^2) + 1)
    tau_0 = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458

    tau_tot_inv_sim = tau_0 - lsq_fit.param[2]
    P_eq_sim = 92.38 * (tau_0 / tau_tot_inv_sim)

    peqs[i] = P_eq_sim
end

orbits = 500
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

for (i, n) in enumerate(nu_range)

    filename = @sprintf "nu_scan_noise/polarizations_0.0005_500_4096_%.2f_delta0.004_ISF.txt" n

    step_polarizations = readdlm(filename, Float64)
    step_polarizations = vec(step_polarizations)

    model1(t, param) = param[1] * exp.(param[2] * t)
    param1 = [1, -0.001]
    lsq_fit = curve_fit(model1, t, step_polarizations, param1)

    cof = pi / (619 * 2)
    τ_dep_inv(ζ; cof=1) = cof * ((ζ^2 - 1) * -expintx(ζ^2) + 1)
    tau_0 = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458

    tau_tot_inv_sim = tau_0 - lsq_fit.param[2]
    P_eq_sim = 92.38 * (tau_0 / tau_tot_inv_sim)

    peqs_noise[i] = P_eq_sim
end

orbits = 500
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

for (i, n) in enumerate(nu_range)

    filename = @sprintf "nu_scan_jim/polarizations_0.0005_500_4096_%.2f_jimISF.txt" n

    step_polarizations = readdlm(filename, Float64)
    step_polarizations = vec(step_polarizations)

    model1(t, param) = param[1] * exp.(param[2] * t)
    param1 = [1, -0.001]
    lsq_fit = curve_fit(model1, t, step_polarizations, param1)

    cof = pi / (619 * 2)
    τ_dep_inv(ζ; cof=1) = cof * ((ζ^2 - 1) * -expintx(ζ^2) + 1)
    tau_0 = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458

    tau_tot_inv_sim = tau_0 - lsq_fit.param[2]
    P_eq_sim = 92.38 * (tau_0 / tau_tot_inv_sim)

    peqs_jim[i] = P_eq_sim
end

orbits = 500
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

for (i, n) in enumerate(nu_range)

    filename = @sprintf "nu_scan_jim_nu/polarizations_0.0005_500_4096_%.2f_jimISF.txt" n

    step_polarizations = readdlm(filename, Float64)
    step_polarizations = vec(step_polarizations)

    model1(t, param) = param[1] * exp.(param[2] * t)
    param1 = [1, -0.001]
    lsq_fit = curve_fit(model1, t, step_polarizations, param1)

    cof = pi / (619 * 2)
    τ_dep_inv(ζ; cof=1) = cof * ((ζ^2 - 1) * -expintx(ζ^2) + 1)
    tau_0 = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458

    tau_tot_inv_sim = tau_0 - lsq_fit.param[2]
    P_eq_sim = 92.38 * (tau_0 / tau_tot_inv_sim)

    peqs_jim_nu[i] = P_eq_sim
end

orbits = 500
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

for (i, n) in enumerate(nu_range)

    filename = @sprintf "nu_scan_desmond/polarizations_0.0005_500_4096_%.2f_desmondISF.txt" n

    step_polarizations = readdlm(filename, Float64)
    step_polarizations = vec(step_polarizations)

    model1(t, param) = param[1] * exp.(param[2] * t)
    param1 = [1, -0.001]
    lsq_fit = curve_fit(model1, t, step_polarizations, param1)

    cof = pi / (619 * 2)
    τ_dep_inv(ζ; cof=1) = cof * ((ζ^2 - 1) * -expintx(ζ^2) + 1)
    tau_0 = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458

    tau_tot_inv_sim = tau_0 - lsq_fit.param[2]
    P_eq_sim = 92.38 * (tau_0 / tau_tot_inv_sim)

    peqs_desmond[i] = P_eq_sim
end

peqs_desmond[46] = NaN  # COMMENT OUT FOR MIDDLE VALUE

p1 = plot(nu_range, peqs, legend=:bottomright, label=L"\nu=\nu_0", xlabel=L"Spin tune $\nu_0$", ylabel="Equlibrium polarization (%)")
# plot!(nu_range, peqs_jim_nu, label=L"Noisy $b$ with $\nu$ dependence")
plot!(nu_range, peqs_jim, label=L"Noisy $b$")
plot!(nu_range, peqs_desmond, label=L"Sine noise in $\nu$")

cof = pi / (619 * 2)
my_beta = 62.45
sigma0 = 1.647065609e-4
my_zeta = (nu_range .- my_beta) ./ sigma0
tau_dep_inv = cof .* ((my_zeta .^ 2 .- 1) .* -expintx.(my_zeta .^ 2) .+ 1)
tau_0_inv = 2pi^2 * 27.54^5 / 99 / 600^2 / 299792458
tau_tot_inv = tau_dep_inv .+ tau_0_inv
peq_ISF = 92.38 .* (tau_0_inv ./ tau_tot_inv)
plot!(nu_range, peq_ISF, label="ISF Approximation")
savefig(p1, "figures/spin_tune_scan.pdf")


ISF = [0.9999944767344675
    0.9999867573447134
    0.9999747151502003
    0.9999740556449473
    0.9999859742074064
    0.9999933769641106
    0.9999857795258177
    0.9999741752469666
    0.9999734359873929
    0.9999850828983655
    0.9999922326985154
    0.9999852134685184
    0.9999741951228571
    0.9999729929371585
    0.9999840466364524
    0.9999910473044052
    0.9999842231482791
    0.9999735492559101
    0.9999722904434895
    0.9999830888368721
    0.9999900311564506
    0.9999832931331739
    0.9999726667352313
    0.9999715201980366
    0.9999821695210042
    0.9999890662862274
    0.9999826511598016
    0.9999722912809941
    0.9999709874407956
    0.9999811252771242
    0.999987777187354
    0.999981690429242
    0.999971529334184
    0.9999702130211305
    0.9999802005215958
    0.9999867835941081
    0.9999808836018467
    0.9999710706013692
    0.9999696992305714
    0.9999793596364982
    0.9999857637714571
    0.9999799166354687
    0.9999702395448873
    0.9999690184090576
    0.9999782209316772
    0.9999847347723314
    0.9999791626580996
    0.9999697335492723
    0.9999686163151936
    0.9999775276492215
    0.9999835460896689
    0.9999782345936385
    0.9999691564995042
    0.9999679769349515
    0.999976712607281
    0.9999825664148544
    0.999977204378145
    0.9999686157840256
    0.999967299652058
    0.9999755323049138
    0.9999811895040656
    0.9999763411899804
    0.9999678599837358
    0.9999665900470696
    0.99997457712666
    0.9999802449373656
    0.9999753506388676
    0.999967233455777
    0.9999658713012068
    0.9999733774655645
    0.9999792582687466
    0.9999745676627415
    0.9999668860047622
    0.9999651830609112
    0.9999724867736033
    0.9999782345911092
    0.9999734622593908
    0.9999661246045729
    0.9999644124259347
    0.9999714631485549
    0.9999770642096331
    0.9999724158520427
    0.999964987678291
    0.9999635324038281
    0.9999705492723217
    0.9999759405167908
    0.9999714438151374
    0.999963901816766
    0.9999626218706632
    0.9999698908866919
    0.9999748789805212
    0.9999704041587748
    0.9999630583214154
    0.9999620267746641
    0.9999686311563717
    0.9999734260876213
    0.9999690385894922
    0.9999621666252037
    0.99996092934803
    0.9999673655369624
    0.9999724111021231
    0.9999681748695308
    0.9999611813682201
    0.9999598981032163
    0.9999664573013612
    0.9999715051941785
    0.999967291509309
    0.9999603161543003
    0.9999592217084302
    0.9999658036515439
    0.9999706222963151
    0.9999662558277972
    0.999959285543019
    0.9999580923977468
    0.9999648879925301
    0.9999695082862406
    0.9999653493339448
    0.9999583798206311
    0.9999572208251895
    0.9999639081852483
    0.9999686573941688
    0.9999644824038313
    0.9999576685132672
    0.999956523457065
    0.9999626711419632
    0.9999674954583937
    0.9999637712382199
    0.9999570716080661
    0.999955457261806
    0.9999615028849952
    0.9999663145561395
    0.9999629753929977
    0.9999564559816004
    0.9999548516863552
    0.9999602980257245
    0.9999651146861452
    0.9999620860706467
    0.9999555078660307
    0.9999539853739521
    0.9999592405911029
    0.999964030170121
    0.9999613254101003
    0.9999547304670469
    0.9999532267740661
    0.9999582327555231
    0.9999629756015675
    0.9999604875286976
    0.9999538758839054
    0.9999524526168563
    0.9999575299716753
    0.999962101909623
    0.9999594398224627
    0.9999530468561971
    0.999951469095985
    0.9999564033440895
    0.9999608398599343
    0.9999583576937511
    0.9999523601147983
    0.9999506011501866
    0.999955045471272
    0.9999595828125992
    0.9999574268220637
    0.9999518215279329
    0.9999498820136432
    0.9999541900858535
    0.9999585820329945
    0.9999564166086771
    0.9999506111019909
    0.9999485561829642
    0.9999527320459378
    0.9999571754259072
    0.9999556282858455
    0.9999496538392335
    0.9999478728683668
    0.9999520539947035
    0.999956369781472
    0.9999546158198365
    0.9999488033289481
    0.9999471066762933
    0.9999510743024053
    0.9999554031563099
    0.9999535884644736
    0.9999479459229265
    0.9999461269698713
    0.9999500235316919
    0.9999542272808302
    0.9999526554668933
    0.9999470245557724
    0.9999450838973498
    0.9999491351768164
    0.999953157258971
    0.9999513626343538
    0.9999457302868786
    0.9999439687903205
    0.999947972054531
    0.9999517220810415
    0.9999499483059017
    0.9999445668967336
    0.9999431066999316
    0.9999471079399509
    0.9999506787714869
    0.9999488894170981
    0.9999436690423731
    0.9999420587567102
    0.999946165211632
    0.9999493835802121
    0.9999476412588131
    0.9999429890165108
    0.99994145868575
    0.9999450965642577
    0.9999484526157009
    0.9999468249224359
    0.9999423361676851
    0.9999409619835135
    0.9999444693241517
    0.9999477372192012
    0.9999460847265376
    0.9999415860567861
    0.999939875503547
    0.999943201671345
    0.9999467796924484
    0.9999452037819451
    0.9999409740681433
    0.9999389963860364
    0.9999423521963674
    0.9999459087651447
    0.9999446194568536
    0.9999401906888855
    0.9999378184122552
    0.999940966793507
    0.9999445281989534
    0.9999435446027843
    0.9999390622834217
    0.9999366880722214
    0.9999395571349726
    0.999943275159707
    0.9999425082647767
    0.9999380433062136
    0.9999360950294047
    0.9999390000355559
    0.999942673046796
    0.9999415752161902
    0.9999370726705965
    0.9999352244543152
    0.9999381955443376
    0.9999413922251806
    0.9999399879252189
    0.9999360031497498
    0.9999343525799518
    0.9999374473696275
    0.999940602807308
    0.9999390039789708
    0.9999351147749732
    0.9999337761271427
    0.9999368014125717
    0.9999399200045391
    0.9999382489474136
    0.9999344025782427
    0.9999326597820057
    0.9999357954373178
    0.9999389271596205
    0.9999371773961525
    0.9999332153106294
    0.9999316079810316
    0.9999347827509274
    0.9999377158431676
    0.9999361145880684
    0.9999323617068437
    0.9999310253990976
    0.9999340872003285
    0.9999367714381708
    0.9999350879654634
    0.9999313682369887
    0.9999300878693806
    0.9999327943396408
    0.9999356855810978
    0.9999340940843598
    0.9999305997441548
    0.9999292315916989
    0.9999317647960391
    0.9999344248009646
    0.9999327884341115
    0.9999293385398502
    0.9999284343258805
    0.999930886280552
    0.9999336778177306
    0.9999322117591349
    0.999928521188972
    0.9999273990968792
    0.999929704430015
    0.9999326300152678
    0.9999315907079457
    0.9999278460569369
    0.9999264839729052
    0.9999286626060552
    0.999931484975021
    0.9999307835041821
    0.9999270489005165
    0.9999254119112867
    0.9999276313259362
    0.9999308429961341
    0.999929960683911
    0.9999263403762695
    0.9999244974926136
    0.999926892527844
    0.9999303675818305
    0.9999296718203358
    0.9999256629442191
    0.999923440321617
    0.9999257347118993
    0.9999292317181409
    0.999928527792773
    0.9999245661775927
    0.9999224363630882
    0.9999247301734139
    0.9999282879092437
    0.9999273164713812
    0.9999235539988793
    0.99992164878369
    0.999923819732923
    0.9999270090944601
    0.9999257944572827
    0.9999221192913922
    0.9999205254939957
    0.9999229936908014
    0.9999258402055791
    0.9999244091536822
    0.9999208081524374
    0.9999197088681512
    0.9999221700555166
    0.9999247000647647
    0.9999231482788578
    0.9999197695101657
    0.999918472703376
    0.9999209342908953
    0.9999238385637744
    0.9999222592578612
    0.9999190001922593
    0.9999175277123601
    0.9999198841414029
    0.9999226780471758
    0.9999216316434923
    0.9999183477335277
    0.9999168451379621
    0.9999190470292684
    0.9999213915477222
    0.99992041062941
    0.9999173774141222
    0.999916211993955
    0.999918421471568
    0.9999203833642706
    0.9999195918750773
    0.9999166707535451
    0.9999149818442382
    0.9999168976767292
    0.9999193793834734
    0.9999185928901291
    0.9999154537993032
    0.9999140055660548
    0.999916058738719
    0.9999185301204268
    0.9999175377355178
    0.9999141523689927
    0.9999128369087921
    0.9999150440215285
    0.9999173248671485
    0.9999163228366112
    0.9999131470114453
    0.9999118677737475
    0.9999140411426781
    0.9999165628187189
    0.9999154061172021
    0.9999122135338284
    0.9999110567990793
    0.9999131952239835
    0.9999158656056921
    0.999914746464153
    0.9999114556695529
    0.9999104499788242
    0.9999126456543396
    0.9999151812533894
    0.9999140633722796
    0.9999104678339148
    0.9999092085948347
    0.9999113453686531
    0.9999140397827782
    0.9999134326788582
    0.9999102453488794
    0.9999084176538466
    0.9999104627997292
    0.9999129202632109
    0.9999124512211801
    0.9999091005692426
    0.9999073203502479
    0.9999091661293066
    0.999911584073067
    0.9999108828041875
    0.9999077058699525
    0.9999060899492307
    0.9999075348612538
    0.9999102125655214
    0.9999095884060536
    0.9999061848548837
    0.9999045484804626
    0.9999064444056021
    0.9999094671052386
    0.9999087489067243
    0.999905013210947
    0.999903353846939
    0.999905430015491
    0.9999085561254719
    0.9999077759672995
    0.9999038380074744
    0.999902560603345
    0.9999049921187004
    0.9999076239258926
    0.9999062921032096
    0.9999029074464671
    0.9999021740489173
    0.9999041549327801
    0.9999063996985279
    0.9999049751527782
    0.999901689089738
    0.9999014765759103
    0.9999032065733157
    0.99990530440328
    0.9999039169016825
    0.999900925652585
    0.9999008438280614
    0.9999026376939615
    0.9999045306612704
    0.9999028365976962
    0.9999001096789523
    0.9999002988703899
    0.9999016905131364
    0.9999032932085177
    0.9999019125868185
    0.9998996676089682
    0.9998998704658819
    0.9999009475260751
    0.9999018730222968
    0.9999001007036397
    0.9998979257412868
    0.99989830546353
    0.999899799770784
    0.9999012043180276
    0.9998994618724792
    0.9998969651864007
    0.999897170508463
    0.9998985537533362
    0.9998999601577921
    0.9998985974146971
    0.9998961796737129
    0.9998961823735389
    0.9998977178426787
    0.9998992261619138
    0.9998977178141802
    0.9998950755680122
    0.9998951604846915
    0.9998968340830516
    0.9998977714133132
    0.9998962376609779
    0.9998940972094623
    0.9998946280466362
    0.9998962018014794
    0.9998966528709571
    0.9998951295957879
    0.9998932110043526
    0.9998934356535819
    0.9998947932375233
    0.9998954989885365
    0.9998945715252834
    0.9998925460959353
    0.9998927586500437
    0.9998939499269234
    0.9998946681112728
    0.9998937429622335
    0.9998918814372967
    0.9998925618154546
    0.9998934821747932
    0.9998937424557846
    0.9998925892294288
    0.9998911804375424
    0.9998920194853848
    0.9998929157714574
    0.9998924057177394
    0.9998908079509683
    0.9998899297307051
    0.9998910789429283
    0.9998920136344094
    0.9998915094836999
    0.9998896148675502
    0.9998885127628617
    0.9998895396676777
    0.9998905938790118
    0.999890415736199
    0.9998887743820358
    0.9998877012965053
    0.9998885383549734
    0.9998897055028984
]

up = [1.0
    0.9999849668822417
    0.9999601649909463
    0.9999598208025313
    0.9999837863553659
    0.9999985747894079
    0.999984001588692
    0.9999598222180481
    0.9999595480743296
    0.9999826609288461
    0.9999971540163763
    0.9999829125183007
    0.9999592384541447
    0.9999592446872472
    0.9999818830453004
    0.9999958979471921
    0.9999820912744267
    0.999959241615665
    0.9999588808734351
    0.9999809919427195
    0.9999944757370457
    0.9999809889829795
    0.9999591014321727
    0.999958761817952
    0.9999800581239249
    0.9999930220075266
    0.9999800138436369
    0.9999590359753647
    0.9999589219481062
    0.9999792489460874
    0.9999913309285862
    0.9999792366846532
    0.9999588919051237
    0.9999584078829209
    0.9999780994222157
    0.9999897889222703
    0.9999782573051906
    0.999958736968438
    0.9999581314488606
    0.9999772697520936
    0.9999885248511404
    0.9999772753295897
    0.9999584652627781
    0.999958043392277
    0.9999763891157343
    0.9999871037828303
    0.9999760864677384
    0.9999580585012376
    0.9999577687215034
    0.9999756394298377
    0.9999857621754493
    0.9999748708138377
    0.9999575210811396
    0.9999573556456522
    0.999974524138031
    0.9999844087002298
    0.9999739685109748
    0.999956887095667
    0.9999568054700455
    0.9999736154035492
    0.9999831212907618
    0.9999729717891997
    0.9999562670420725
    0.999956260714965
    0.9999723774741577
    0.9999818285220442
    0.9999720385028122
    0.9999558600222722
    0.9999554473115035
    0.9999711605174748
    0.9999805583614865
    0.9999711260770049
    0.9999553136845303
    0.9999550371730633
    0.99997036550634
    0.9999795633376438
    0.9999702003342635
    0.9999546420043058
    0.9999546181062224
    0.9999695340752386
    0.999978304063435
    0.9999687812462748
    0.9999540941092872
    0.9999544583538074
    0.9999685697432923
    0.9999769210036213
    0.9999677283039845
    0.9999535876622545
    0.9999539651739066
    0.9999677887200008
    0.999975982254916
    0.9999668838088143
    0.9999531138829716
    0.9999532175262973
    0.999966773276868
    0.999974707983583
    0.9999660310190304
    0.9999527878889685
    0.9999527983270194
    0.9999656388962512
    0.999973361570285
    0.9999650737699294
    0.9999520493283883
    0.9999521873391971
    0.9999645604415881
    0.9999719029666057
    0.9999640580279744
    0.9999514463406519
    0.9999516487863039
    0.9999635426695758
    0.9999704774213032
    0.9999627324288647
    0.9999508506213998
    0.9999508887205503
    0.9999625320741249
    0.9999692137058984
    0.9999616573460518
    0.9999502187246524
    0.9999505312125192
    0.9999617687010257
    0.999968150505291
    0.9999607539364672
    0.9999495885426821
    0.9999496010509928
    0.9999605005940101
    0.9999668333225344
    0.999959411018842
    0.999948921121762
    0.9999492281269771
    0.9999597818248871
    0.9999656754749786
    0.9999585802668075
    0.99994835627323
    0.9999485285089925
    0.9999587908864394
    0.9999643604556866
    0.999957328661124
    0.9999474809942179
    0.999947771763683
    0.9999574950876168
    0.9999628292107375
    0.9999562508669402
    0.9999466552972506
    0.9999468742885079
    0.9999562473828967
    0.9999616506718083
    0.9999549353674965
    0.9999459038534535
    0.9999462691773181
    0.9999553858330404
    0.9999602657984408
    0.9999541236563578
    0.9999455659942201
    0.9999456230757621
    0.9999543701621048
    0.999959354185791
    0.9999535593681776
    0.9999452891769444
    0.9999455211931584
    0.9999537306053312
    0.9999583757761589
    0.9999527787363004
    0.9999448012638367
    0.9999447502151324
    0.9999524504823669
    0.9999567143433739
    0.9999512829161921
    0.9999436500592686
    0.9999437605706475
    0.999951347005082
    0.9999555457315356
    0.999950248131459
    0.99994273346954
    0.9999426308945466
    0.9999499980026795
    0.9999546271175952
    0.9999497014806054
    0.9999421874164749
    0.9999418063927112
    0.9999489234860124
    0.9999534780276975
    0.999948716499599
    0.9999415403740962
    0.9999408530768903
    0.9999478054378961
    0.9999525502597596
    0.9999481317880068
    0.9999410943820533
    0.9999403294646914
    0.9999469988991724
    0.9999513365150866
    0.9999471608326751
    0.999940673441159
    0.9999396245090069
    0.9999457859878416
    0.9999500929075464
    0.9999460237915808
    0.9999398713767376
    0.99993865092474
    0.999944555055586
    0.9999488677777472
    0.9999452283894515
    0.9999394825124855
    0.9999377733298167
    0.9999435000747262
    0.9999479949356236
    0.9999441684160046
    0.9999385615171733
    0.999936815703096
    0.9999426603830012
    0.9999470555005823
    0.9999434398747645
    0.9999377080813114
    0.9999357141987669
    0.99994147116474
    0.9999455656962205
    0.9999425026653855
    0.9999371251318985
    0.9999353194981302
    0.9999406817936606
    0.9999446648191734
    0.9999417034117911
    0.9999366652937457
    0.9999343481735551
    0.9999394475877444
    0.9999434110804843
    0.9999406141170979
    0.9999359071239096
    0.999933317726026
    0.9999381706081473
    0.999942037240927
    0.9999397537923963
    0.9999351673805363
    0.999932718146944
    0.9999371662264084
    0.9999409264199103
    0.9999390492316993
    0.9999345851957577
    0.9999319119399352
    0.9999360952890353
    0.9999393097572088
    0.9999374050081052
    0.999933624574743
    0.9999308659381105
    0.9999347812531846
    0.9999378203873556
    0.9999363878423346
    0.9999328853427072
    0.9999302930484051
    0.9999338489336065
    0.9999370622144872
    0.9999355535732838
    0.9999315753727568
    0.9999291644696294
    0.9999328372546004
    0.9999359693806723
    0.9999342222866056
    0.9999304980749298
    0.9999286915757323
    0.9999325344022547
    0.9999349880360686
    0.9999331392859685
    0.9999292485876409
    0.999927857821419
    0.9999317757605809
    0.999934307852087
    0.9999326026517144
    0.9999281671393095
    0.9999267200387294
    0.999930345465764
    0.9999329541910599
    0.9999313900482484
    0.9999273381605975
    0.9999257654079763
    0.9999293463697528
    0.9999314379826013
    0.9999299186960455
    0.9999262939346938
    0.9999250686164619
    0.9999282134894321
    0.999929877044442
    0.9999284626352096
    0.9999249040836292
    0.9999238939557578
    0.9999272380517582
    0.9999288614902152
    0.9999271353072644
    0.9999234818576128
    0.9999227490569823
    0.9999261108394628
    0.9999276239315986
    0.9999260758144756
    0.9999223680147878
    0.999921997536037
    0.9999255518175242
    0.9999266397714479
    0.999924943454471
    0.9999214554923445
    0.9999209370450609
    0.9999243445717447
    0.9999255666526308
    0.9999241195753696
    0.9999209010184489
    0.9999200455268858
    0.9999231582910446
    0.9999245940978867
    0.9999233078560206
    0.9999200765279042
    0.9999194457489683
    0.9999223338900151
    0.9999233377392021
    0.9999219391869842
    0.9999188531854948
    0.9999180871781358
    0.9999212403809459
    0.9999221700684156
    0.9999208397407116
    0.999918103679162
    0.999917092233665
    0.9999198078022977
    0.9999208348998355
    0.9999200073883713
    0.9999173771077335
    0.9999164447926309
    0.9999191379116528
    0.9999202633542468
    0.9999193442733086
    0.9999163550311212
    0.999915328506856
    0.9999178891691303
    0.9999186290896533
    0.999917774418369
    0.9999150787351
    0.9999143388926476
    0.9999170441269699
    0.9999173463026392
    0.9999160170483202
    0.9999134122237083
    0.999913064364618
    0.9999162055188457
    0.9999166192590857
    0.9999152827854774
    0.9999128219444814
    0.9999122275583746
    0.9999152070164171
    0.9999154411618619
    0.9999140332128849
    0.999911659929124
    0.9999112232432525
    0.9999141314906312
    0.999914595327244
    0.9999134042541715
    0.9999111496840858
    0.999910868481352
    0.9999135450820487
    0.9999135078047957
    0.9999121963603671
    0.9999103469348992
    0.999909911069155
    0.9999122657547659
    0.9999123227608416
    0.9999115657820773
    0.999909443742385
    0.9999085649557767
    0.9999111097562813
    0.9999111694808941
    0.9999104772314894
    0.999908332146802
    0.9999077173400378
    0.9999103841172462
    0.9999105453981046
    0.9999096754702184
    0.9999074628365765
    0.9999065556603745
    0.9999093432189928
    0.9999098964221389
    0.9999089738004875
    0.9999064053892812
    0.9999055541546946
    0.999908204169734
    0.9999085146960534
    0.9999077526251492
    0.9999053406974868
    0.9999048412849972
    0.9999074851250956
    0.9999073541720479
    0.999906676154644
    0.9999043607240785
    0.9999034654454236
    0.99990622088352
    0.9999064555038433
    0.9999057127095576
    0.9999030908421583
    0.9999020992425804
    0.9999053446846046
    0.9999056604854286
    0.9999045546390198
    0.999902088537806
    0.9999011655387546
    0.9999042349721758
    0.9999045874668165
    0.9999033713956864
    0.9999014493202917
    0.9999005069331882
    0.999903324115758
    0.9999036027860155
    0.9999026435560807
    0.9999007998034691
    0.9998999186968708
    0.999902510901661
    0.9999028354192435
    0.9999016365854309
    0.9998997962275624
    0.9998991311978254
    0.9999014444383538
    0.9999017718109875
    0.9999005244377879
    0.9998988102929863
    0.999898353515389
    0.9999004766193605
    0.9999007886072011
    0.9998997303786334
    0.9998983253804069
    0.9998978832899302
    0.9998997406425076
    0.9998997156744802
    0.9998986816737977
    0.9998973977651264
    0.9998967703924623
    0.9998981309586922
    0.9998986093731043
    0.9998980107796044
    0.9998971429685538
    0.999896189231879
    0.9998974387986216
    0.9998978264134005
    0.9998968839996399
    0.9998959720755728
    0.9998958858615431
    0.9998973012678727
    0.9998976513871749
    0.9998962873141873
    0.9998950531233796
    0.9998948559953696
    0.9998962406386158
    0.9998965511819377
    0.9998950681668973
    0.9998938791067071
    0.9998939363370565
    0.999895243777087
    0.9998955083373323
    0.9998941668365758
    0.9998931701719231
    0.999893097324677
    0.9998942480706516
    0.9998941957862746
    0.9998925009302546
    0.999891338384339
    0.9998915501482987
    0.9998934543529584
    0.9998938132035181
    0.9998918713801437
    0.999890337401078
    0.9998905018773676
    0.9998922529773138
    0.9998925860960459
    0.9998913518434981
    0.9998905810449323
    0.9998899449688218
    0.9998913896717174
    0.9998917031544433
    0.9998902953076373
    0.999889522554142
    0.9998884786388029
    0.9998901829639428
    0.9998911428742172
    0.9998898255334717
    0.9998887616998928
    0.9998873462154609
    0.9998888624559817
    0.9998899004430759
    0.9998888839985123
    0.9998877543535644
    0.9998865299708404
    0.9998879784094583
    0.9998890643241445
    0.9998883057616025
    0.9998870760903443
    0.9998859148955259
    0.999887465636693
    0.9998879895368029
    0.9998870787055394
    0.9998860030847189
    0.9998845596587705
    0.9998861770331061
    0.9998864023813532
    0.9998855351764752
    0.999884739742741
    0.9998834395154891
    0.9998853020857057
]

orbits = 2000
tf = orbits * 2pi

measurements = 500

t = range(0, tf, measurements + 1)
t = t[1:end-1] ./ 2pi
t = collect(t)

p2 = plot(t, up, xlabel="Turn", ylabel="Polarization", label="Spins initialized up")
plot!(t, ISF, label="Spins initialized along ISF")

savefig(p2, "figures/up_ISF.pdf")
